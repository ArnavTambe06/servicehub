{"ast":null,"code":"var _jsxFileName = \"C:\\\\Project\\\\servicehub\\\\src\\\\pages\\\\Account.js\";\nimport React, { useState, useContext, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { AuthContext } from '../contexts/AuthContext';\nimport { signOut, deleteUser, reauthenticateWithCredential, EmailAuthProvider } from 'firebase/auth';\nimport { auth, db } from '../firebaseInit';\nimport { doc, getDoc, deleteDoc } from 'firebase/firestore';\nimport { Redirect } from 'react-router';\nimport Loading from '../components/Loading';\nimport UserAccount from './UserAccount';\nimport ProviderAccount from './ProviderAccount';\nconst Account = () => {\n  const history = useHistory();\n  const {\n    currentUser,\n    setCurrentUser,\n    isProvider,\n    setIsProvider\n  } = useContext(AuthContext);\n  const [loading, setLoading] = useState(false);\n  const [userData, setUserData] = useState({\n    userDataFirstName: '',\n    userDataLastName: '',\n    userDataEmail: '',\n    userDataAddress: '',\n    userDataNumber: '',\n    userDataCart: []\n  });\n  const [providerData, setProviderData] = useState({\n    providerDataFirstName: '',\n    providerDataLastName: '',\n    providerDataCompanyName: '',\n    providerDataEmail: '',\n    providerDataNumber: '',\n    providerDataDescription: '',\n    providerDataServices: []\n  });\n\n  // Run Read function on app mount:\n  useEffect(() => {\n    fireStoreRead();\n    // eslint-disable-next-line\n  }, []);\n\n  // Read Firestore for account info:\n  const fireStoreRead = async () => {\n    setLoading(true);\n    // var getWhich = 'users'\n    // if (isProvider) {\n    //     getWhich = 'providers'\n    // }\n    var docSnap = await getDoc(doc(db, 'users', currentUser.uid));\n    if (docSnap.exists()) {\n      setUserData({\n        ...userData,\n        userDataFirstName: docSnap.data().name,\n        userDataLastName: docSnap.data().lastname,\n        userDataEmail: docSnap.data().email,\n        userDataAddress: docSnap.data().address,\n        userDataNumber: docSnap.data().number,\n        userDataCart: docSnap.data().cart\n      });\n      setIsProvider(false);\n    } else {\n      docSnap = await getDoc(doc(db, 'providers', currentUser.uid));\n      if (docSnap.exists()) {\n        setProviderData({\n          ...providerData,\n          providerDataFirstName: docSnap.data().providerFirstName,\n          providerDataLastName: docSnap.data().providerLastName,\n          providerDataCompanyName: docSnap.data().providerCompanyName,\n          providerDataEmail: docSnap.data().providerEmail,\n          providerDataNumber: docSnap.data().providerNumber,\n          providerDataDescription: docSnap.data().providerDescription,\n          providerDataServices: docSnap.data().providerServices\n        });\n        setIsProvider(true);\n      } else {\n        console.log(`No such users/providers found.`);\n      }\n    }\n    setLoading(false);\n  };\n  const onSignOutSubmit = e => {\n    e.preventDefault();\n    setLoading(true);\n    signOut(auth).then(() => {\n      setCurrentUser(null);\n      setIsProvider(false);\n    }).catch(error => {\n      console.log(error);\n    });\n    setLoading(false);\n  };\n  const onDeleteUser = async e => {\n    e.preventDefault();\n    const password = prompt(\"Enter your password to confirm account deletion:\");\n    if (!password) {\n      alert(\"Password is required to delete your account.\");\n      return;\n    }\n    const credential = EmailAuthProvider.credential(currentUser.email, password);\n    try {\n      setLoading(true);\n      await reauthenticateWithCredential(currentUser, credential);\n      const collectionName = isProvider ? 'providers' : 'users';\n      await deleteDoc(doc(db, collectionName, currentUser.uid));\n      await deleteUser(currentUser);\n      alert('Successfully Deleted!');\n      history.push('/login');\n    } catch (error) {\n      alert(\"Deletion failed: \" + error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n  if (currentUser !== null) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"ninetyfiveperc-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 13\n      }\n    }, loading ? /*#__PURE__*/React.createElement(Loading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 28\n      }\n    }) : /*#__PURE__*/React.createElement(React.Fragment, null, !isProvider ? /*#__PURE__*/React.createElement(UserAccount, {\n      userData: userData,\n      setUserData: setUserData,\n      onSignOutSubmit: onSignOutSubmit,\n      onDeleteUser: onDeleteUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 25\n      }\n    }) : /*#__PURE__*/React.createElement(ProviderAccount, {\n      providerData: providerData,\n      setProviderData: setProviderData,\n      onSignOutSubmit: onSignOutSubmit,\n      onDeleteUser: onDeleteUser,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 27\n      }\n    })));\n  } else {\n    return /*#__PURE__*/React.createElement(Redirect, {\n      to: \"/\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 16\n      }\n    });\n  }\n};\nexport default Account;","map":{"version":3,"names":["React","useState","useContext","useEffect","useHistory","AuthContext","signOut","deleteUser","reauthenticateWithCredential","EmailAuthProvider","auth","db","doc","getDoc","deleteDoc","Redirect","Loading","UserAccount","ProviderAccount","Account","history","currentUser","setCurrentUser","isProvider","setIsProvider","loading","setLoading","userData","setUserData","userDataFirstName","userDataLastName","userDataEmail","userDataAddress","userDataNumber","userDataCart","providerData","setProviderData","providerDataFirstName","providerDataLastName","providerDataCompanyName","providerDataEmail","providerDataNumber","providerDataDescription","providerDataServices","fireStoreRead","docSnap","uid","exists","data","name","lastname","email","address","number","cart","providerFirstName","providerLastName","providerCompanyName","providerEmail","providerNumber","providerDescription","providerServices","console","log","onSignOutSubmit","e","preventDefault","then","catch","error","onDeleteUser","password","prompt","alert","credential","collectionName","push","message","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","Fragment","to"],"sources":["C:/Project/servicehub/src/pages/Account.js"],"sourcesContent":["import React, { useState, useContext, useEffect } from 'react'\r\nimport { useHistory } from 'react-router-dom'\r\nimport { AuthContext } from '../contexts/AuthContext'\r\nimport { signOut, deleteUser, reauthenticateWithCredential, EmailAuthProvider } from 'firebase/auth'\r\nimport { auth, db } from '../firebaseInit'\r\nimport { doc, getDoc, deleteDoc } from 'firebase/firestore'\r\nimport { Redirect } from 'react-router'\r\nimport Loading from '../components/Loading'\r\nimport UserAccount from './UserAccount'\r\nimport ProviderAccount from './ProviderAccount'\r\n\r\nconst Account = () => {\r\n\r\n    const history = useHistory()\r\n    const { currentUser, setCurrentUser, isProvider, setIsProvider } = useContext(AuthContext)\r\n    const [loading, setLoading] = useState(false)\r\n    const [userData, setUserData] = useState({\r\n        userDataFirstName: '',\r\n        userDataLastName: '',\r\n        userDataEmail: '',\r\n        userDataAddress: '',\r\n        userDataNumber: '',\r\n        userDataCart: []\r\n    })\r\n\r\n    const [providerData, setProviderData] = useState({\r\n        providerDataFirstName: '',\r\n        providerDataLastName: '',\r\n        providerDataCompanyName: '',\r\n        providerDataEmail: '',\r\n        providerDataNumber: '',\r\n        providerDataDescription: '',\r\n        providerDataServices: []\r\n    })\r\n\r\n    // Run Read function on app mount:\r\n    useEffect(() => {\r\n        fireStoreRead()\r\n        // eslint-disable-next-line\r\n    }, [])\r\n\r\n    // Read Firestore for account info:\r\n    const fireStoreRead = async () => {\r\n        setLoading(true)\r\n        // var getWhich = 'users'\r\n        // if (isProvider) {\r\n        //     getWhich = 'providers'\r\n        // }\r\n        var docSnap = await getDoc(doc(db, 'users', currentUser.uid))\r\n        if (docSnap.exists()) {\r\n            setUserData({\r\n                ...userData,\r\n                userDataFirstName: docSnap.data().name,\r\n                userDataLastName: docSnap.data().lastname,\r\n                userDataEmail: docSnap.data().email,\r\n                userDataAddress: docSnap.data().address,\r\n                userDataNumber: docSnap.data().number,\r\n                userDataCart: docSnap.data().cart\r\n            })\r\n            setIsProvider(false)\r\n        } else {\r\n            docSnap = await getDoc(doc(db, 'providers', currentUser.uid))\r\n            if (docSnap.exists()) {\r\n                setProviderData({\r\n                    ...providerData,\r\n                    providerDataFirstName: docSnap.data().providerFirstName,\r\n                    providerDataLastName: docSnap.data().providerLastName,\r\n                    providerDataCompanyName: docSnap.data().providerCompanyName,\r\n                    providerDataEmail: docSnap.data().providerEmail,\r\n                    providerDataNumber: docSnap.data().providerNumber,\r\n                    providerDataDescription: docSnap.data().providerDescription,\r\n                    providerDataServices: docSnap.data().providerServices\r\n                })\r\n                setIsProvider(true)\r\n            } else {\r\n                console.log(`No such users/providers found.`)\r\n            }\r\n        }\r\n        setLoading(false)\r\n    }\r\n\r\n    const onSignOutSubmit = (e) => {\r\n        e.preventDefault()\r\n        setLoading(true)\r\n        signOut(auth).then(() => {\r\n            setCurrentUser(null)\r\n            setIsProvider(false)\r\n        }).catch((error) => {\r\n            console.log(error)\r\n        });\r\n        setLoading(false)\r\n    }\r\n\r\n    const onDeleteUser = async (e) => {\r\n        e.preventDefault()\r\n        const password = prompt(\"Enter your password to confirm account deletion:\")\r\n        if (!password) {\r\n            alert(\"Password is required to delete your account.\")\r\n            return\r\n        }\r\n\r\n        const credential = EmailAuthProvider.credential(currentUser.email, password)\r\n        try {\r\n            setLoading(true)\r\n            await reauthenticateWithCredential(currentUser, credential)\r\n            const collectionName = isProvider ? 'providers' : 'users'\r\n            await deleteDoc(doc(db, collectionName, currentUser.uid))\r\n            await deleteUser(currentUser)\r\n            alert('Successfully Deleted!')\r\n            history.push('/login')\r\n        } catch (error) {\r\n            alert(\"Deletion failed: \" + error.message)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    if (currentUser !== null) {\r\n        return (\r\n            <div className='ninetyfiveperc-container'>\r\n                {loading ? <Loading /> : <>\r\n                    {!isProvider ?\r\n                        <UserAccount userData={userData} setUserData={setUserData} onSignOutSubmit={onSignOutSubmit} onDeleteUser={onDeleteUser} />\r\n                        : <ProviderAccount providerData={providerData} setProviderData={setProviderData} onSignOutSubmit={onSignOutSubmit} onDeleteUser={onDeleteUser} />\r\n                    }\r\n                </>}\r\n            </div>\r\n        )\r\n    } else {\r\n        return <Redirect to='/' />\r\n    }\r\n}\r\n\r\nexport default Account"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,UAAU,EAAEC,SAAS,QAAQ,OAAO;AAC9D,SAASC,UAAU,QAAQ,kBAAkB;AAC7C,SAASC,WAAW,QAAQ,yBAAyB;AACrD,SAASC,OAAO,EAAEC,UAAU,EAAEC,4BAA4B,EAAEC,iBAAiB,QAAQ,eAAe;AACpG,SAASC,IAAI,EAAEC,EAAE,QAAQ,iBAAiB;AAC1C,SAASC,GAAG,EAAEC,MAAM,EAAEC,SAAS,QAAQ,oBAAoB;AAC3D,SAASC,QAAQ,QAAQ,cAAc;AACvC,OAAOC,OAAO,MAAM,uBAAuB;AAC3C,OAAOC,WAAW,MAAM,eAAe;AACvC,OAAOC,eAAe,MAAM,mBAAmB;AAE/C,MAAMC,OAAO,GAAGA,CAAA,KAAM;EAElB,MAAMC,OAAO,GAAGhB,UAAU,CAAC,CAAC;EAC5B,MAAM;IAAEiB,WAAW;IAAEC,cAAc;IAAEC,UAAU;IAAEC;EAAc,CAAC,GAAGtB,UAAU,CAACG,WAAW,CAAC;EAC1F,MAAM,CAACoB,OAAO,EAAEC,UAAU,CAAC,GAAGzB,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAAC0B,QAAQ,EAAEC,WAAW,CAAC,GAAG3B,QAAQ,CAAC;IACrC4B,iBAAiB,EAAE,EAAE;IACrBC,gBAAgB,EAAE,EAAE;IACpBC,aAAa,EAAE,EAAE;IACjBC,eAAe,EAAE,EAAE;IACnBC,cAAc,EAAE,EAAE;IAClBC,YAAY,EAAE;EAClB,CAAC,CAAC;EAEF,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGnC,QAAQ,CAAC;IAC7CoC,qBAAqB,EAAE,EAAE;IACzBC,oBAAoB,EAAE,EAAE;IACxBC,uBAAuB,EAAE,EAAE;IAC3BC,iBAAiB,EAAE,EAAE;IACrBC,kBAAkB,EAAE,EAAE;IACtBC,uBAAuB,EAAE,EAAE;IAC3BC,oBAAoB,EAAE;EAC1B,CAAC,CAAC;;EAEF;EACAxC,SAAS,CAAC,MAAM;IACZyC,aAAa,CAAC,CAAC;IACf;EACJ,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMA,aAAa,GAAG,MAAAA,CAAA,KAAY;IAC9BlB,UAAU,CAAC,IAAI,CAAC;IAChB;IACA;IACA;IACA;IACA,IAAImB,OAAO,GAAG,MAAMhC,MAAM,CAACD,GAAG,CAACD,EAAE,EAAE,OAAO,EAAEU,WAAW,CAACyB,GAAG,CAAC,CAAC;IAC7D,IAAID,OAAO,CAACE,MAAM,CAAC,CAAC,EAAE;MAClBnB,WAAW,CAAC;QACR,GAAGD,QAAQ;QACXE,iBAAiB,EAAEgB,OAAO,CAACG,IAAI,CAAC,CAAC,CAACC,IAAI;QACtCnB,gBAAgB,EAAEe,OAAO,CAACG,IAAI,CAAC,CAAC,CAACE,QAAQ;QACzCnB,aAAa,EAAEc,OAAO,CAACG,IAAI,CAAC,CAAC,CAACG,KAAK;QACnCnB,eAAe,EAAEa,OAAO,CAACG,IAAI,CAAC,CAAC,CAACI,OAAO;QACvCnB,cAAc,EAAEY,OAAO,CAACG,IAAI,CAAC,CAAC,CAACK,MAAM;QACrCnB,YAAY,EAAEW,OAAO,CAACG,IAAI,CAAC,CAAC,CAACM;MACjC,CAAC,CAAC;MACF9B,aAAa,CAAC,KAAK,CAAC;IACxB,CAAC,MAAM;MACHqB,OAAO,GAAG,MAAMhC,MAAM,CAACD,GAAG,CAACD,EAAE,EAAE,WAAW,EAAEU,WAAW,CAACyB,GAAG,CAAC,CAAC;MAC7D,IAAID,OAAO,CAACE,MAAM,CAAC,CAAC,EAAE;QAClBX,eAAe,CAAC;UACZ,GAAGD,YAAY;UACfE,qBAAqB,EAAEQ,OAAO,CAACG,IAAI,CAAC,CAAC,CAACO,iBAAiB;UACvDjB,oBAAoB,EAAEO,OAAO,CAACG,IAAI,CAAC,CAAC,CAACQ,gBAAgB;UACrDjB,uBAAuB,EAAEM,OAAO,CAACG,IAAI,CAAC,CAAC,CAACS,mBAAmB;UAC3DjB,iBAAiB,EAAEK,OAAO,CAACG,IAAI,CAAC,CAAC,CAACU,aAAa;UAC/CjB,kBAAkB,EAAEI,OAAO,CAACG,IAAI,CAAC,CAAC,CAACW,cAAc;UACjDjB,uBAAuB,EAAEG,OAAO,CAACG,IAAI,CAAC,CAAC,CAACY,mBAAmB;UAC3DjB,oBAAoB,EAAEE,OAAO,CAACG,IAAI,CAAC,CAAC,CAACa;QACzC,CAAC,CAAC;QACFrC,aAAa,CAAC,IAAI,CAAC;MACvB,CAAC,MAAM;QACHsC,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAC;MACjD;IACJ;IACArC,UAAU,CAAC,KAAK,CAAC;EACrB,CAAC;EAED,MAAMsC,eAAe,GAAIC,CAAC,IAAK;IAC3BA,CAAC,CAACC,cAAc,CAAC,CAAC;IAClBxC,UAAU,CAAC,IAAI,CAAC;IAChBpB,OAAO,CAACI,IAAI,CAAC,CAACyD,IAAI,CAAC,MAAM;MACrB7C,cAAc,CAAC,IAAI,CAAC;MACpBE,aAAa,CAAC,KAAK,CAAC;IACxB,CAAC,CAAC,CAAC4C,KAAK,CAAEC,KAAK,IAAK;MAChBP,OAAO,CAACC,GAAG,CAACM,KAAK,CAAC;IACtB,CAAC,CAAC;IACF3C,UAAU,CAAC,KAAK,CAAC;EACrB,CAAC;EAED,MAAM4C,YAAY,GAAG,MAAOL,CAAC,IAAK;IAC9BA,CAAC,CAACC,cAAc,CAAC,CAAC;IAClB,MAAMK,QAAQ,GAAGC,MAAM,CAAC,kDAAkD,CAAC;IAC3E,IAAI,CAACD,QAAQ,EAAE;MACXE,KAAK,CAAC,8CAA8C,CAAC;MACrD;IACJ;IAEA,MAAMC,UAAU,GAAGjE,iBAAiB,CAACiE,UAAU,CAACrD,WAAW,CAAC8B,KAAK,EAAEoB,QAAQ,CAAC;IAC5E,IAAI;MACA7C,UAAU,CAAC,IAAI,CAAC;MAChB,MAAMlB,4BAA4B,CAACa,WAAW,EAAEqD,UAAU,CAAC;MAC3D,MAAMC,cAAc,GAAGpD,UAAU,GAAG,WAAW,GAAG,OAAO;MACzD,MAAMT,SAAS,CAACF,GAAG,CAACD,EAAE,EAAEgE,cAAc,EAAEtD,WAAW,CAACyB,GAAG,CAAC,CAAC;MACzD,MAAMvC,UAAU,CAACc,WAAW,CAAC;MAC7BoD,KAAK,CAAC,uBAAuB,CAAC;MAC9BrD,OAAO,CAACwD,IAAI,CAAC,QAAQ,CAAC;IAC1B,CAAC,CAAC,OAAOP,KAAK,EAAE;MACZI,KAAK,CAAC,mBAAmB,GAAGJ,KAAK,CAACQ,OAAO,CAAC;IAC9C,CAAC,SAAS;MACNnD,UAAU,CAAC,KAAK,CAAC;IACrB;EACJ,CAAC;EAED,IAAIL,WAAW,KAAK,IAAI,EAAE;IACtB,oBACIrB,KAAA,CAAA8E,aAAA;MAAKC,SAAS,EAAC,0BAA0B;MAAAC,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,GACpC5D,OAAO,gBAAGzB,KAAA,CAAA8E,aAAA,CAAC9D,OAAO;MAAAgE,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CAAE,CAAC,gBAAGrF,KAAA,CAAA8E,aAAA,CAAA9E,KAAA,CAAAsF,QAAA,QACpB,CAAC/D,UAAU,gBACRvB,KAAA,CAAA8E,aAAA,CAAC7D,WAAW;MAACU,QAAQ,EAAEA,QAAS;MAACC,WAAW,EAAEA,WAAY;MAACoC,eAAe,EAAEA,eAAgB;MAACM,YAAY,EAAEA,YAAa;MAAAU,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CAAE,CAAC,gBACzHrF,KAAA,CAAA8E,aAAA,CAAC5D,eAAe;MAACiB,YAAY,EAAEA,YAAa;MAACC,eAAe,EAAEA,eAAgB;MAAC4B,eAAe,EAAEA,eAAgB;MAACM,YAAY,EAAEA,YAAa;MAAAU,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CAAE,CAEtJ,CACD,CAAC;EAEd,CAAC,MAAM;IACH,oBAAOrF,KAAA,CAAA8E,aAAA,CAAC/D,QAAQ;MAACwE,EAAE,EAAC,GAAG;MAAAP,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA;IAAA,CAAE,CAAC;EAC9B;AACJ,CAAC;AAED,eAAelE,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module"}